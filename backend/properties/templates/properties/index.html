{% extends 'base.html' %}

{% block title %}Properties - EstateHub{% endblock %}

{% block extra_css %}
<style>
    .hero {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        padding: 3rem 1.5rem;
        text-align: center;
        border-radius: 12px;
        margin-bottom: 2rem;
    }

    .filters {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        margin-bottom: 2rem;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .filter-group label {
        font-weight: 600;
        font-size: 0.9rem;
    }

    .filter-group select,
    .filter-group input {
        padding: 0.75rem;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 1rem;
    }

    .properties-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 2rem;
    }

    .property-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
    }

    .property-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--shadow-lg);
    }

    .property-image {
        width: 100%;
        height: 220px;
        object-fit: cover;
    }

    .property-content {
        padding: 1.5rem;
    }

    .property-title {
        font-size: 1.3rem;
        margin-bottom: 0.5rem;
        font-weight: 700;
    }

    .property-location {
        color: var(--text-light);
        margin-bottom: 0.5rem;
    }

    .property-price {
        font-size: 1.5rem;
        color: var(--primary-color);
        font-weight: 700;
        margin-bottom: 1rem;
    }

    .property-meta {
        display: flex;
        gap: 1rem;
        padding-top: 1rem;
        border-top: 1px solid var(--border-color);
        margin-bottom: 1rem;
    }

    .property-actions {
        display: flex;
        gap: 0.5rem;
    }

    .badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 6px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .badge-sale {
        background-color: var(--secondary-color);
        color: white;
    }

    .badge-rent {
        background-color: #f59e0b;
        color: white;
    }

    .pagination {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-top: 3rem;
        flex-wrap: wrap;
    }

    .pagination a,
    .pagination span {
        padding: 0.5rem 1rem;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        text-decoration: none;
        color: var(--text-dark);
        transition: all 0.3s;
    }

    .pagination a:hover {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .pagination .current {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
</style>
{% endblock %}

{% block content %}
<div class="hero">
    <h1>{% if language == 'ar' %}Ø§Ø¹Ø«Ø± Ø¹Ù„Ù‰ Ù…Ù†Ø²Ù„ Ø£Ø­Ù„Ø§Ù…Ùƒ{% else %}Find Your Dream Home{% endif %}</h1>
    <p>{% if language == 'ar' %}Ø§ÙƒØªØ´Ù Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ù…Ø«Ø§Ù„ÙŠ{% else %}Discover the perfect property{% endif %}</p>
</div>

<form method="GET" class="filters">
    <div class="filter-group" style="grid-column: 1 / -1;">
        <label>{% if language == 'ar' %}Ø¨Ø­Ø«{% else %}Search{% endif %}</label>
        <input type="text" name="search"
            placeholder="{% if language == 'ar' %}Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù†ØŒ ÙˆØµÙ...{% else %}Search by title, description...{% endif %}"
            value="{{ request.GET.search }}">
    </div>

    <div class="filter-group">
        <label>{% if language == 'ar' %}Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‚Ø§Ø±{% else %}Property Type{% endif %}</label>
        <select name="type">
            <option value="">All Types</option>
            {% for value, label in property_types %}
            <option value="{{ value }}" {% if request.GET.type == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-group">
        <label>{% if language == 'ar' %}Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ¹{% else %}Sale Type{% endif %}</label>
        <select name="sale_type">
            <option value="">All</option>
            {% for value, label in sale_types %}
            <option value="{{ value }}" {% if request.GET.sale_type == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="filter-group">
        <label>{% if language == 'ar' %}Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø¯Ù†Ù‰{% else %}Min Price{% endif %}</label>
        <input type="number" name="min_price" placeholder="0" value="{{ request.GET.min_price }}">
    </div>

    <div class="filter-group">
        <label>{% if language == 'ar' %}Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ù‚ØµÙ‰{% else %}Max Price{% endif %}</label>
        <input type="number" name="max_price" placeholder="Any" value="{{ request.GET.max_price }}">
    </div>

    <div class="filter-group" style="align-self: end;">
        <button type="submit" class="btn btn-primary" style="width: 100%;">
            ğŸ” {% if language == 'ar' %}Ø¨Ø­Ø«{% else %}Search{% endif %}
        </button>
    </div>
</form>

<h2>{% if language == 'ar' %}Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©{% else %}Available Properties{% endif %} ({{ page_obj.paginator.count }})
</h2>

<div class="properties-grid">
    {% for property in properties %}
    <div class="property-card">
        {% if property.images.first %}
        <img src="{{ property.images.first.image.url }}" alt="{{ property.get_title }}" class="property-image">
        {% else %}
        <img src="https://via.placeholder.com/400x220?text=No+Image" alt="No image" class="property-image">
        {% endif %}

        <div class="property-content">
            <span class="badge {% if property.sale_type == 'Sale' %}badge-sale{% else %}badge-rent{% endif %}">
                {{ property.get_sale_type_display }}
            </span>

            <h3 class="property-title">{{ property.get_title }}</h3>

            <div class="property-location">
                ğŸ“ {{ property.get_location }}
            </div>

            <div class="property-price">
                {{ property.price|floatformat:0 }}
            </div>

            <div class="property-meta">
                <span><strong>{% if language == 'ar' %}Ø§Ù„Ù†ÙˆØ¹{% else %}Type{% endif %}:</strong> {{
                    property.property_type }}</span>
                <span><strong>ğŸ‘ï¸</strong> {{ property.views }}</span>
            </div>

            <div class="property-actions">
                <a href="{% url 'property_detail' property.pk %}" class="btn btn-primary"
                    style="flex: 1; text-align: center;">
                    {% if language == 'ar' %}Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„{% else %}View Details{% endif %}
                </a>
                {% if user == property.owner %}
                <a href="{% url 'property_update' property.pk %}" class="btn btn-secondary">Edit</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div style="grid-column: 1/-1; text-align: center; padding: 3rem;">
        <h3>{% if language == 'ar' %}Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù‚Ø§Ø±Ø§Øª{% else %}No Properties Found{% endif %}</h3>
    </div>
    {% endfor %}
</div>

{% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a
                href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">Â«
                {% if language == 'ar' %}Ø§Ù„Ø£ÙˆÙ„Ù‰{% else %}First{% endif %}</a>
            <a
                href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">â€¹
                {% if language == 'ar' %}Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©{% else %}Previous{% endif %}</a>
            {% endif %}

            <span class="current">
                {% if language == 'ar' %}ØµÙØ­Ø©{% else %}Page{% endif %} {{ page_obj.number }} {% if language == 'ar' %}Ù…Ù†{% else %}of{% endif %} {{ page_obj.paginator.num_pages }}
            </span>

            {% if page_obj.has_next %}
            <a
                href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{% if language == 'ar' %}Ø§Ù„ØªØ§Ù„ÙŠØ©{% else %}Next{% endif %} â€º</a>
            <a
                href="?page={{ page_obj.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{% if language == 'ar' %}Ø§Ù„Ø£Ø®ÙŠØ±Ø©{% else %}Last{% endif %} Â»</a>
        {% endif %}
    </div>
{% endif %}
{% endblock %}